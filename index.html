<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hydra AI SÃ¼rÃ¼ Kontrol Merkezi</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --primary: #00ff41; --bg: #0a0a0a; --panel: #111; --text: #eee; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; }
        .panel { background: var(--panel); border: 1px solid #333; padding: 20px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        h1, h2, h3 { color: var(--primary); margin-top: 0; text-transform: uppercase; letter-spacing: 2px; }
        label { display: block; margin-bottom: 5px; font-size: 12px; color: #888; }
        input, select { background: #222; border: 1px solid #444; color: #fff; padding: 10px; width: 100%; box-sizing: border-box; margin-bottom: 15px; border-radius: 4px; }
        input:focus { border-color: var(--primary); outline: none; }
        button { background: var(--primary); color: #000; border: none; padding: 12px; cursor: pointer; font-weight: bold; width: 100%; border-radius: 4px; transition: 0.3s; }
        button:hover { background: #fff; transform: translateY(-2px); }
        .status-msg { font-size: 12px; margin-top: 10px; text-align: center; }
        
        /* GiriÅŸ Perdesi */
        #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 1000; display: flex; align-items: center; justify-content: center; }
        .login-box { width: 350px; padding: 40px; border: 1px solid var(--primary); background: #050505; border-radius: 10px; }
        
        .bot-card { border-left: 4px solid var(--primary); padding: 10px; background: #1a1a1a; margin-bottom: 10px; display: flex; justify-content: space-between; }
        .key-tag { font-size: 10px; background: #333; padding: 2px 6px; border-radius: 4px; margin-right: 5px; }
    </style>
</head>
<body>

    <div id="loginOverlay">
        <div class="login-box">
            <h2>ðŸ”’ SISTEM ERISIMI</h2>
            <p style="font-size: 13px; color: #666; margin-bottom: 20px;">Supabase veritabanÄ± anahtarlarÄ±nÄ±zÄ± girin.</p>
            
            <label>PROJECT URL</label>
            <input type="text" id="supaUrlInput" placeholder="https://xyz.supabase.co">
            
            <label>ANON PUBLIC KEY</label>
            <input type="text" id="supaKeyInput" placeholder="eyJh...">
            
            <button id="connectBtn" onclick="connectSystem()">SISTEME BAGLAN</button>
            <div id="loginMsg" class="status-msg"></div>
        </div>
    </div>

    <div class="container" id="mainDashboard" style="display: none;">
        <h1>ðŸ¤– HYDRA AI SWARM V1</h1>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div>
                <div class="panel">
                    <h3>ðŸŽ® OYUN AYARLARI</h3>
                    <label>BOSS (SENIN ADIN)</label>
                    <input type="text" id="bossName" placeholder="Minecraft ID">
                    
                    <label>SUNUCU IP</label>
                    <input type="text" id="serverIp" placeholder="oyna.sunucu.com">
                    
                    <button onclick="saveGameSettings()">AYARLARI KAYDET</button>
                </div>

                <div class="panel">
                    <h3>âš¡ AI API HAVUZU</h3>
                    <select id="providerSelect">
                        <option value="groq">Groq (Llama 3)</option>
                        <option value="gemini">Gemini (Google)</option>
                    </select>
                    <input type="text" id="newApiKey" placeholder="API AnahtarÄ±nÄ± YapÄ±ÅŸtÄ±r">
                    <button onclick="addApiKey()">ANAHTAR EKLE (+)</button>
                    <div id="keyList" style="margin-top: 15px; max-height: 150px; overflow-y: auto;"></div>
                </div>
            </div>

            <div>
                <div class="panel">
                    <h3>ðŸ“¡ SURU DURUMU</h3>
                    <div id="botList">YÃ¼kleniyor...</div>
                </div>
                
                <div class="panel">
                    <h3>ðŸ§  SON OGRENILENLER</h3>
                    <div id="memoryLogs" style="font-size: 11px; color: #888;">HafÄ±za boÅŸ.</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // GLOBAL DEÄžÄ°ÅžKEN - Ä°SÄ°M Ã‡AKIÅžMASI OLMAMASI Ä°Ã‡Ä°N Ã–ZEL Ä°SÄ°M VERÄ°LDÄ°
        let globalSupabase = null;

        // Sayfa aÃ§Ä±ldÄ±ÄŸÄ±nda hafÄ±zayÄ± kontrol et
        window.onload = function() {
            const savedUrl = localStorage.getItem('hydra_url');
            const savedKey = localStorage.getItem('hydra_key');
            if(savedUrl && savedKey) {
                document.getElementById('supaUrlInput').value = savedUrl;
                document.getElementById('supaKeyInput').value = savedKey;
            }
        };

        async function connectSystem() {
            const url = document.getElementById('supaUrlInput').value.trim();
            const key = document.getElementById('supaKeyInput').value.trim();
            const msg = document.getElementById('loginMsg');

            if (!url || !key) {
                msg.innerHTML = "<span style='color:red'>Hata: BoÅŸ alan bÄ±rakmayÄ±n!</span>";
                return;
            }

            msg.innerHTML = "BaÄŸlanÄ±yor...";

            try {
                // Client OluÅŸturma
                globalSupabase = window.supabase.createClient(url, key);

                // Test Sorgusu
                const { data, error } = await globalSupabase.from('bot_settings').select('*').limit(1);

                if (error) throw error;

                // BaÅŸarÄ±lÄ±ysa
                localStorage.setItem('hydra_url', url);
                localStorage.setItem('hydra_key', key);
                
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('mainDashboard').style.display = 'block';
                
                // Ä°lk veri Ã§ekme
                refreshAll();
                setInterval(refreshAll, 10000); // 10 saniyede bir otomatik yenile

            } catch (err) {
                console.error(err);
                msg.innerHTML = `<span style='color:red'>Hata: ${err.message}</span>`;
            }
        }

        async function saveGameSettings() {
            const boss = document.getElementById('bossName').value;
            const ip = document.getElementById('serverIp').value;

            await globalSupabase.from('bot_settings').upsert({ key_name: 'boss_name', value_text: boss });
            await globalSupabase.from('bot_settings').upsert({ key_name: 'server_ip', value_text: ip });
            
            alert("Oyun ayarlarÄ± kaydedildi! Botlar uyanÄ±yor...");
        }

        async function addApiKey() {
            const provider = document.getElementById('providerSelect').value;
            const key = document.getElementById('newApiKey').value.trim();
            
            if(!key) return;

            const { error } = await globalSupabase.from('api_vault').insert({ provider, api_key: key });
            
            if(!error) {
                document.getElementById('newApiKey').value = "";
                listApiKeys();
            } else {
                alert("Hata: " + error.message);
            }
        }

        async function listApiKeys() {
            const { data } = await globalSupabase.from('api_vault').select('*');
            const listDiv = document.getElementById('keyList');
            if(data) {
                listDiv.innerHTML = data.map(k => `
                    <div style="margin-bottom:5px;">
                        <span class="key-tag">${k.provider}</span> 
                        <code>...${k.api_key.slice(-6)}</code>
                    </div>
                `).join('');
            }
        }

        async function fetchBotData() {
            const { data } = await globalSupabase.from('bot_identities').select('*');
            const botDiv = document.getElementById('botList');
            if(data && data.length > 0) {
                botDiv.innerHTML = data.map(bot => `
                    <div class="bot-card">
                        <span>ðŸ¤– <b>${bot.role}</b></span>
                        <span style="color:#888; font-size:12px;">${bot.username}</span>
                    </div>
                `).join('');
            } else {
                botDiv.innerHTML = "HenÃ¼z bot kaydÄ± yok.";
            }
        }

        function refreshAll() {
            listApiKeys();
            fetchBotData();
        }
    </script>
</body>
</html>
